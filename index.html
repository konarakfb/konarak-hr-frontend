<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Konarak HR System</title>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    header { background: #0a7cff; color: white; padding: 15px; text-align: center; font-size: 20px; }
    #container { display: flex; min-height: 100vh; }
    #menu {
      width: 220px; background: white; border-right: solid 1px #ddd;
      padding: 15px; box-sizing: border-box;
    }
    #menu button {
      width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid #ccc;
      border-radius: 6px; background: #f8f8f8; cursor: pointer;
    }
    #content { flex: 1; padding: 20px; }
    .card {
      background: white; padding: 20px; border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    input, select {
      width: 100%; padding: 10px; margin-top: 8px;
      border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box;
    }
    button.primary {
      background: #0a7cff; color: white; border: none;
      padding: 10px 16px; border-radius: 6px; margin-top: 12px; cursor: pointer;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td {
      border: 1px solid #ddd; padding: 10px; text-align: left;
    }
    th { background: #e9e9e9; }
    
    /* MOBILE */
    @media (max-width: 768px) {
      #container { flex-direction: column; }
      #menu { width: 100%; border-right: none; border-bottom: 1px solid #ddd; }
      #menu button { margin-bottom: 5px; }
    }
  </style>
</head>

<body>

<header>Konarak F&B - HR System</header>

<div id="container">

  <!-- SIDE MENU -->
  <div id="menu">
    <button onclick="showPage('dashboard')">Dashboard</button>
    <button onclick="showPage('employees')">Employees</button>
  </div>

  <!-- CONTENT -->
  <div id="content">

    <!-- DASHBOARD PAGE -->
    <div id="dashboard" class="page">
      <div class="card">
        <h2>Dashboard</h2>
        <p>Total Employees: <b id="dash_total">0</b></p>
      </div>
    </div>

    <!-- EMPLOYEE PAGE -->
    <div id="employees" class="page" style="display:none;">
      <div class="card">
        <h2>Add Employee</h2>

        <input id="emp_emp_code" placeholder="Employee Code (KFB001)">
        <input id="emp_first_name" placeholder="First Name">
        <input id="emp_last_name" placeholder="Last Name">
        <input id="emp_email" placeholder="Email">
        <input id="emp_phone" placeholder="Phone">
        <input id="emp_dob" type="date" placeholder="DOB">
        <input id="emp_joining_date" type="date" placeholder="Joining Date">
        <input id="emp_relieving_date" type="date" placeholder="Relieving Date">

        <select id="emp_department">
          <option value="">Select Department</option>
          <option>HR</option>
          <option>Kitchen</option>
          <option>Billing</option>
          <option>Service</option>
          <option>Store</option>
        </select>

        <input id="emp_role" placeholder="Role">
        <select id="emp_status">
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>

        <button class="primary" onclick="saveEmployee()">Save Employee</button>
      </div>

      <div class="card">
        <h2>Employee List</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Code</th><th>Name</th><th>Phone</th><th>Dept</th>
            </tr>
          </thead>
          <tbody id="emp_table"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script>
/* ------------------------ CONFIG ------------------------ */
const API_URL = "https://script.google.com/macros/s/AKfycbz4rodVHWpkqjpITJbozIZpRX6rE8G7jSgMwfEs30zj51wFMYH0RdiTFL9Cz2bQqo7U/exec";
const API_KEY = "konarak123456789secret";

/* ------------------------ PAGE SWITCH ------------------------ */
function showPage(page) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById(page).style.display = "block";

  if (page === "employees") loadEmployees();
  if (page === "dashboard") loadEmployeesDashboard();
}

/* ------------------------ SAVE EMPLOYEE ------------------------ */
async function saveEmployee() {

  const payload = {
    action: "create_employee",
    key: API_KEY,

    emp_code:        document.getElementById("emp_emp_code").value,
    first_name:      document.getElementById("emp_first_name").value,
    last_name:       document.getElementById("emp_last_name").value,
    email:           document.getElementById("emp_email").value,
    phone:           document.getElementById("emp_phone").value,
    dob:             document.getElementById("emp_dob").value,
    joining_date:    document.getElementById("emp_joining_date").value,
    relieving_date:  document.getElementById("emp_relieving_date").value,
    department:      document.getElementById("emp_department").value,
    role:            document.getElementById("emp_role").value,
    status:          document.getElementById("emp_status").value
  };

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    console.log("SAVE RESPONSE:", data);

    if (data.success) {
      alert("Employee added!");
      loadEmployees();
    } else {
      alert("Error: " + data.error);
    }

  } catch (err) {
    alert("Failed to fetch: " + err);
  }
}

/* ------------------------ LOAD EMPLOYEES ------------------------ */
async function loadEmployees() {
  const url = `${API_URL}?action=list_employees&key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();

  console.log("LIST:", data);

  const tbody = document.getElementById("emp_table");
  tbody.innerHTML = "";

  if (data.success) {
    data.data.forEach(emp => {
      tbody.innerHTML += `
        <tr>
          <td>${emp.id}</td>
          <td>${emp.emp_code}</td>
          <td>${emp.first_name} ${emp.last_name}</td>
          <td>${emp.phone}</td>
          <td>${emp.department}</td>
        </tr>
      `;
    });
  }
}

/* ------------------------ DASHBOARD ------------------------ */
async function loadEmployeesDashboard() {
  const url = `${API_URL}?action=list_employees&key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();

  if (data.success) {
    document.getElementById("dash_total").innerText = data.data.length;
  }
}
</script>

</body>
</html>
